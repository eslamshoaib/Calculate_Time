<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محول الإحداثيات الدقيق</title>
    <style>
        body {
            font-family: 'Tajawal', Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1a73e8;
            text-align: center;
            margin-bottom: 30px;
        }
        .input-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .coordinate-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background-color: #1765cc;
        }
        .result-section {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #e8f0fe;
            border-radius: 8px;
        }
        .result-item {
            margin-bottom: 10px;
        }
        .result-label {
            font-weight: bold;
            color: #1a73e8;
        }
        .map-link {
            display: inline-block;
            margin-top: 15px;
            padding: 10px 15px;
            background-color: #34a853;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
        }
        .map-link:hover {
            background-color: #2d9249;
        }
        .conversion-steps {
            background: #f1f3f4;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
        }
        .step {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        @media (min-width: 768px) {
            .container {
                max-width: 600px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>محول الإحداثيات الدقيق</h1>
        
        <div class="input-section">
            <h3>أدخل الإحداثيات:</h3>
            <input type="text" id="northing" class="coordinate-input" placeholder="N 3121258" value="N 3121258">
            <input type="text" id="easting" class="coordinate-input" placeholder="E 2713105" value="E 2713105">
            <button onclick="convertCoordinates()">تحويل الإحداثيات</button>
        </div>
        
        <div id="resultSection" class="result-section">
            <h3>النتائج:</h3>
            <div class="result-item">
                <span class="result-label">الإحداثيات الأصلية:</span>
                <span id="originalCoords"></span>
            </div>
            <div class="result-item">
                <span class="result-label">التفسير:</span>
                <span id="interpretation"></span>
            </div>
            <div class="result-item">
                <span class="result-label">خط العرض (DD):</span>
                <span id="latitude"></span>
            </div>
            <div class="result-item">
                <span class="result-label">خط الطول (DD):</span>
                <span id="longitude"></span>
            </div>
            <a id="mapLink" class="map-link" href="#" target="_blank">عرض على خرائط جوجل</a>
            
            <div class="conversion-steps">
                <h4>خطوات التحويل:</h4>
                <div id="conversionSteps"></div>
            </div>
        </div>
    </div>

    <script>
        function convertCoordinates() {
            // Get input values
            const northing = document.getElementById('northing').value.trim();
            const easting = document.getElementById('easting').value.trim();
            
            // Validate inputs
            if (!northing || !easting) {
                alert("الرجاء إدخال قيم للإحداثيات");
                return;
            }
            
            // Process coordinates
            const result = processMilitaryCoordinates(northing, easting);
            
            // Display results
            document.getElementById('originalCoords').textContent = `${northing} ${easting}`;
            document.getElementById('interpretation').textContent = result.interpretation;
            document.getElementById('latitude').textContent = result.latitude.toFixed(7) + '°';
            document.getElementById('longitude').textContent = result.longitude.toFixed(7) + '°';
            document.getElementById('mapLink').href = `https://www.google.com/maps?q=${result.latitude},${result.longitude}`;
            
            // Show conversion steps
            document.getElementById('conversionSteps').innerHTML = `
                <div class="step"><strong>خط العرض:</strong> ${result.latSteps.join(" → ")}</div>
                <div class="step"><strong>خط الطول:</strong> ${result.lonSteps.join(" → ")}</div>
            `;
            
            // Show result section
            document.getElementById('resultSection').style.display = 'block';
        }
        
        function processMilitaryCoordinates(northing, easting) {
            // Initialize steps for explanation
            const latSteps = [];
            const lonSteps = [];
            
            // Process Northing (Latitude) - format: N 3121258
            const latMatch = northing.match(/N\s*(\d{2})(\d{2})(\d{2})(\d+)?/i);
            if (!latMatch) {
                throw new Error("تنسيق خط العرض غير صحيح");
            }
            
            const latDeg = parseInt(latMatch[1]);
            const latMin = parseInt(latMatch[2]);
            const latSec = parseInt(latMatch[3]);
            const latDecimal = parseFloat(`0.${latMatch[4] || '0'}`) * 60; // Convert decimal part to seconds
            
            const totalLatSec = latSec + latDecimal;
            const latDec = latDeg + (latMin / 60) + (totalLatSec / 3600);
            
            latSteps.push(
                `N ${latDeg}${latMin}${latSec}.${latMatch[4] || '0'}`,
                `تقسيم: ${latDeg}° ${latMin}' ${totalLatSec.toFixed(1)}"`,
                `التحويل: ${latDeg} + (${latMin}/60) + (${totalLatSec.toFixed(1)}/3600)`,
                `النتيجة: ${latDec.toFixed(7)}°`
            );
            
            // Process Easting (Longitude) - format: E 2713105
            const lonMatch = easting.match(/E\s*(\d{3})(\d{2})(\d{2})(\d+)?/i);
            if (!lonMatch) {
                throw new Error("تنسيق خط الطول غير صحيح");
            }
            
            const lonDeg = parseInt(lonMatch[1]);
            const lonMin = parseInt(lonMatch[2]);
            const lonSec = parseInt(lonMatch[3]);
            const lonDecimal = parseFloat(`0.${lonMatch[4] || '0'}`) * 60; // Convert decimal part to seconds
            
            const totalLonSec = lonSec + lonDecimal;
            const lonDec = lonDeg + (lonMin / 60) + (totalLonSec / 3600);
            
            lonSteps.push(
                `E ${lonDeg}${lonMin}${lonSec}.${lonMatch[4] || '0'}`,
                `تقسيم: ${lonDeg}° ${lonMin}' ${totalLonSec.toFixed(1)}"`,
                `التحويل: ${lonDeg} + (${lonMin}/60) + (${totalLonSec.toFixed(1)}/3600)`,
                `النتيجة: ${lonDec.toFixed(7)}°`
            );
            
            return {
                latitude: latDec,
                longitude: lonDec,
                interpretation: "صيغة عسكرية/ميدانية (DDMMSS.D): درجة-دقيقة-ثانية مع كسر عشري",
                latSteps: latSteps,
                lonSteps: lonSteps
            };
        }
    </script>
</body>
</html>