
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>    ğŸŒğŸŒğŸŒğŸŒ</title>
    <style>
        :root {
            --primary-color: #1a73e8;
            --secondary-color: #34a853;
            --accent-color: #ea4335;
            --light-gray: #f5f5f5;
            --dark-gray: #202124;
            --white: #ffffff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f8f9fa;
            color: var(--dark-gray);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .upload-section {
            background-color: var(--white);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border: 2px dashed #dadce0;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
            margin-bottom: 15px;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .custom-file-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--white);
            padding: 12px 24px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
        }
        
        button {
            background-color: var(--secondary-color);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            max-width: 300px;
            margin: 10px auto;
            display: block;
        }
        
        button:disabled {
            background-color: #bdc1c6;
            cursor: not-allowed;
        }
        
        .results-container {
            margin-top: 30px;
            display: none;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        
        th {
            background-color: var(--light-gray);
            position: sticky;
            top: 0;
        }
        
        .map-link {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .map-link:hover {
            text-decoration: underline;
        }
        
        .status-message {
            text-align: center;
            margin: 15px 0;
            font-weight: 500;
            color: var(--primary-color);
        }
        
        .error-message {
            color: var(--accent-color);
            text-align: center;
            margin: 15px 0;
            display: none;
        }
        
        .coordinate-value {
            font-family: monospace;
            background-color: var(--light-gray);
            padding: 2px 5px;
            border-radius: 3px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Ù…Ø­ÙˆÙ„ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø¥Ù„Ù‰ Ø®Ø±Ø§Ø¦Ø· Google</h1>
        
        <div class="upload-section">
            <div class="file-input-wrapper">
                <input type="file" id="excelFile" accept=".xlsx, .xls" />
                <label for="excelFile" class="custom-file-button">
                    Ø§Ø®ØªØ± Ù…Ù„Ù Excel
                </label>
            </div>
            <div id="fileName" style="margin: 10px 0; color: #5f6368;">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</div>
            <button id="processBtn" onclick="processFile()" disabled>Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù</button>
            
            <div class="status-message" id="statusMessage"></div>
            <div class="error-message" id="errorMessage"></div>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th>MSISDN</th>
                        <th>Ù…Ø¹Ø±Ù Ø§Ù„Ø®Ù„ÙŠØ©</th>
                        <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                        <th>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©</th>
                        <th>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (N)</th>
                        <th>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (E)</th>
                        <th>Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø±ÙŠØ·Ø©</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Global variables
        let processing = false;
        
        // DOM elements
        const excelFileInput = document.getElementById('excelFile');
        const processBtn = document.getElementById('processBtn');
        const fileNameDisplay = document.getElementById('fileName');
        const statusMessage = document.getElementById('statusMessage');
        const errorMessage = document.getElementById('errorMessage');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultsBody = document.getElementById('resultsBody');
        
        // Event listeners
        excelFileInput.addEventListener('change', function(e) {
            if (this.files.length > 0) {
                fileNameDisplay.textContent = `Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø±: ${this.files[0].name}`;
                processBtn.disabled = false;
            } else {
                fileNameDisplay.textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù';
                processBtn.disabled = true;
            }
        });
        
        // Main processing function
        async function processFile() {
            if (processing) return;
            
            const file = excelFileInput.files[0];
            if (!file) {
                showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Excel Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            // Reset UI
            processing = true;
            processBtn.disabled = true;
            processBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
            errorMessage.style.display = 'none';
            resultsContainer.style.display = 'none';
            statusMessage.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù...';
            
            try {
                const data = await readFile(file);
                const jsonData = convertToJson(data);
                const processedData = processExcelData(jsonData);
                
                displayResults(processedData);
                
                processing = false;
                processBtn.disabled = false;
                processBtn.textContent = 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù';
                statusMessage.textContent = 'ØªÙ… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­!';
                
                setTimeout(() => {
                    statusMessage.textContent = '';
                }, 3000);
                
            } catch (err) {
                console.error(err);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù');
                processing = false;
                processBtn.disabled = false;
                processBtn.textContent = 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù';
            }
        }
        
        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve(new Uint8Array(e.target.result));
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
        
        function convertToJson(data) {
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            return XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
        }
        
        function processExcelData(jsonData) {
            // Find column indices
            const headerRow = jsonData[0];
            const msisdnIndex = headerRow.indexOf('MSISDN');
            const cellIdIndex = headerRow.indexOf('Cell_ID');
            const cityIndex = headerRow.indexOf('CITY');
            const coordsIndex = headerRow.findIndex(col => col.includes("'N'||LATITUDE||'E'||LONGITUDE"));
            
            if (msisdnIndex === -1 || cellIdIndex === -1 || coordsIndex === -1) {
                throw new Error('ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ØªÙˆØ§ÙÙ‚. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
            }
            
            const results = [];
            
            // Process each row (skip header)
            for (let i = 1; i < jsonData.length; i++) {
                const row = jsonData[i];
                if (!row || row.length === 0) continue;
                
                const originalCoords = row[coordsIndex];
                const coordinateResult = parseCoordinates(originalCoords);
                
                results.push({
                    msisdn: row[msisdnIndex] || 'ØºÙŠØ± Ù…ØªÙˆÙØ±',
                    cellId: row[cellIdIndex] || 'ØºÙŠØ± Ù…ØªÙˆÙØ±',
                    city: row[cityIndex] || 'ØºÙŠØ± Ù…ØªÙˆÙØ±',
                    originalCoords: originalCoords || 'ØºÙŠØ± Ù…ØªÙˆÙØ±',
                    latitude: coordinateResult.latitude,
                    longitude: coordinateResult.longitude,
                    mapLink: coordinateResult.mapLink
                });
            }
            
            return results;
        }
        
        function parseCoordinates(coordString) {
            if (!coordString) {
                return {
                    latitude: 'ØºÙŠØ± ØµØ§Ù„Ø­',
                    longitude: 'ØºÙŠØ± ØµØ§Ù„Ø­',
                    mapLink: '#'
                };
            }
            
            // Extract numeric parts from format: 'N'||3121258||'E'||2713105
            const pattern = /'N'\|\|(\d+)\|\|'E'\|\|(\d+)/;
            const match = coordString.match(pattern);
            
            if (!match || match.length < 3) {
                return {
                    latitude: 'ØªÙ†Ø³ÙŠÙ‚ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                    longitude: 'ØªÙ†Ø³ÙŠÙ‚ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                    mapLink: '#'
                };
            }
            
            const latStr = match[1]; // e.g. "3121258"
            const lonStr = match[2];  // e.g. "2713105"
            
            // Convert from DMS format (DDMMSS) to decimal degrees
            const latitude = convertDmsToDecimal(latStr, true);
            const longitude = convertDmsToDecimal(lonStr, false);
            
            return {
                latitude: latitude.toFixed(7),
                longitude: longitude.toFixed(7),
                mapLink: `https://www.google.com/maps?q=${latitude},${longitude}`
            };
        }
        
        function convertDmsToDecimal(dmsStr, isLatitude) {
            // Pad with zeros if necessary to ensure 7 digits
            const padded = dmsStr.padStart(7, '0');
            
            // For latitude (N/S): DDMMSS
            // For longitude (E/W): DDDMMSS
            const degDigits = isLatitude ? 2 : 3;
            
            const deg = parseInt(padded.substring(0, degDigits));
            const min = parseInt(padded.substring(degDigits, degDigits + 2));
            const sec = parseInt(padded.substring(degDigits + 2, degDigits + 4));
            
            // Convert to decimal degrees
            return deg + (min / 60) + (sec / 3600);
        }
        
        function displayResults(data) {
            resultsBody.innerHTML = '';
            
            if (data.length === 0) {
                showError('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù');
                return;
            }
            
            data.forEach(item => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${item.msisdn}</td>
                    <td>${item.cellId}</td>
                    <td>${item.city}</td>
                    <td><span class="coordinate-value">${item.originalCoords}</span></td>
                    <td><span class="coordinate-value">${item.latitude}</span></td>
                    <td><span class="coordinate-value">${item.longitude}</span></td>
                    <td><a href="${item.mapLink}" target="_blank" class="map-link">Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a></td>
                `;
                
                resultsBody.appendChild(row);
            });
            
            resultsContainer.style.display = 'block';
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }
    </script>
</body>
</html>