<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل بيانات الموبايل</title>
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        input[type="file"] {
            display: block;
            margin: 20px auto;
            padding: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: right;
            border: 1px solid #ddd;
        }
        th {
            background-color: #3498db;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        a {
            color: #3498db;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .no-data {
            text-align: center;
            color: #e74c3c;
            font-size: 1.2em;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>تفاصيل بيانات الموبايل</h1>
        <input type="file" id="fileInput" accept=".xlsx, .xls" />
        <table id="dataTable">
            <thead>
                <tr>
                    <th>رقم الهاتف</th>
                    <th>IMSI</th>
                    <th>IMEI</th>
                    <th>التبديل الرئيسي</th>
                    <th>معرف الخلية</th>
                    <th>رقم الخلية</th>
                    <th>LAC</th>
                    <th>حالة 4G</th>
                    <th>MME</th>
                    <th>المنطقة الفرعية</th>
                    <th>المدينة</th>
                    <th>عنوان المالك</th>
                    <th>إحداثيات الموقع</th>
                    <th>رابط خرائط جوجل</th>
                    <th>معرف الموقع</th>
                    <th>حالة الموبايل</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
        <p id="noData" class="no-data" style="display: none;">لم يتم تحميل بيانات بعد. الرجاء رفع ملف Excel.</p>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const tableBody = document.getElementById('tableBody');
        const noData = document.getElementById('noData');

        fileInput.addEventListener('change', handleFile);

        function handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                // Clear previous table data
                tableBody.innerHTML = '';
                noData.style.display = 'none';

                if (jsonData.length === 0) {
                    noData.style.display = 'block';
                    return;
                }

                // Process each row
                jsonData.forEach(row => {
                    // Convert coordinates from N3121258E2713105 format to decimal
                    let lat = '', lon = '';
                    const coords = row["'N'||LATITUDE||'E'||LONGITUDE"];
                    if (coords) {
                        const match = coords.match(/N(\d{2})(\d{2})(\d{2}\.?\d*)E(\d{2})(\d{2})(\d{2}\.?\d*)/);
                        if (match) {
                            const latDeg = parseInt(match[1]);
                            const latMin = parseInt(match[2]);
                            const latSec = parseFloat(match[3]);
                            const lonDeg = parseInt(match[4]);
                            const lonMin = parseInt(match[5]);
                            const lonSec = parseFloat(match[6]);
                            lat = (latDeg + latMin / 60 + latSec / 3600).toFixed(5);
                            lon = (lonDeg + lonMin / 60 + lonSec / 3600).toFixed(5);
                        }
                    }

                    const googleMapsLink = lat && lon ? 
                        `<a href="https://www.google.com/maps?q=${lat},${lon}&z=15" target="_blank">عرض على خرائط جوجل</a>` : 
                        '-';

                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row.MSISDN || '-'}</td>
                        <td>${row.IMSI || '-'}</td>
                        <td>${row.IMEI || '-'}</td>
                        <td>${row.Covering_Switch || '-'}</td>
                        <td>${row.Cell_ID || '-'}</td>
                        <td>${row.Cell_Number || '-'}</td>
                        <td>${row.LAC || '-'}</td>
                        <td>${row.status4g || '-'}</td>
                        <td>${row.MME || '-'}</td>
                        <td>${row.MINOR_AREA || '-'}</td>
                        <td>${row.CITY || '-'}</td>
                        <td>${row.LANDLORD_ADDRESS || '-'}</td>
                        <td>${coords ? `N ${lat} E ${lon}` : '-'}</td>
                        <td>${googleMapsLink}</td>
                        <td>${row.SITE_ID || '-'}</td>
                        <td>${row.Mobile_state === 'BUSY' ? 'مشغول' : row.Mobile_state || '-'}</td>
                    `;
                    tableBody.appendChild(tr);
                });
            };
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>