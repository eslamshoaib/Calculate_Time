<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ø­Ù„Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ</title>
<script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
<style>
body { font-family: Arial; background:#f0f0f0; text-align:center; padding:20px; }
.container { background:#fff; padding:20px; border-radius:10px; max-width:500px; margin:auto; }
input,button { padding:10px; margin:5px; width:90%; font-size:16px; }
img { max-width:100%; margin-top:10px; border:1px solid #ccc; }
.result { text-align:right; margin-top:15px; background:#fafafa; padding:10px; border-radius:5px; }
</style>
</head>
<body>
<div class="container">
<h2>ğŸ“‹ Ù…Ø­Ù„Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ø§Ù„Ù…ØµØ±ÙŠ</h2>

<input type="file" id="fileInput" accept="image/*">
<button onclick="processImage()">ğŸ“· Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† ØµÙˆØ±Ø©</button>
<br>
<input type="text" id="nationalID" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ (14 Ø±Ù‚Ù…)">
<button onclick="analyzeID()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</button>

<img id="preview" style="display:none;">
<div id="status"></div>
<div class="result" id="result"></div>
</div>

<script>
// ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø´Ø±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
function convertArabicNums(str) {
    const map = {'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9'};
    return str.replace(/[Ù -Ù©]/g, d => map[d]);
}

// ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ
function analyzeID() {
    let id = convertArabicNums(document.getElementById('nationalID').value.trim());
    if (!/^[23]\d{13}$/.test(id)) {
        document.getElementById('result').innerHTML = "âŒ Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­";
        return;
    }
    const century = id[0] === '2' ? '19' : '20';
    const year = parseInt(id.substr(1,2));
    const month = parseInt(id.substr(3,2));
    const day = parseInt(id.substr(5,2));
    const birthDate = new Date(`${century}${year}-${month}-${day}`);
    const today = new Date();
    let ageY = today.getFullYear()-birthDate.getFullYear();
    let ageM = today.getMonth()-birthDate.getMonth();
    let ageD = today.getDate()-birthDate.getDate();
    if(ageD<0){ageM--;ageD+=new Date(today.getFullYear(),today.getMonth(),0).getDate();}
    if(ageM<0){ageY--;ageM+=12;}
    const gender = parseInt(id[12])%2===0 ? 'Ø£Ù†Ø«Ù‰' : 'Ø°ÙƒØ±';
    const govs = {"01":"Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©","02":"Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©","03":"Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯","04":"Ø§Ù„Ø³ÙˆÙŠØ³","11":"Ø¯Ù…ÙŠØ§Ø·","12":"Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©","13":"Ø§Ù„Ø´Ø±Ù‚ÙŠØ©","14":"Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©","15":"ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®","16":"Ø§Ù„ØºØ±Ø¨ÙŠØ©","17":"Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©","18":"Ø§Ù„Ø¨Ø­ÙŠØ±Ø©","19":"Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©","21":"Ø§Ù„Ø¬ÙŠØ²Ø©","22":"Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ","23":"Ø§Ù„ÙÙŠÙˆÙ…","24":"Ø§Ù„Ø£Ù‚ØµØ±","25":"Ø³ÙˆÙ‡Ø§Ø¬","26":"Ù‚Ù†Ø§","27":"Ø£Ø³ÙˆØ§Ù†","28":"Ø£Ø³ÙŠÙˆØ·","29":"Ù…Ø·Ø±ÙˆØ­","31":"Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡","32":"Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡","33":"Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±","88":"Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ©"};
    const gov = govs[id.substr(7,2)] || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    document.getElementById('result').innerHTML =
        `<b>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</b> ${birthDate.toLocaleDateString('ar-EG')}<br>
         <b>ğŸ‚ Ø§Ù„Ø¹Ù…Ø±:</b> ${ageY} Ø³Ù†Ø© Ùˆ ${ageM} Ø´Ù‡Ø± Ùˆ ${ageD} ÙŠÙˆÙ…<br>
         <b>ğŸš» Ø§Ù„Ø¬Ù†Ø³:</b> ${gender}<br>
         <b>ğŸ“ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</b> ${gov}`;
}

// Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù…Ù† ØµÙˆØ±Ø©
function processImage() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) return alert("Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹");
    const reader = new FileReader();
    reader.onload = function(e) {
        document.getElementById('preview').src = e.target.result;
        document.getElementById('preview').style.display = 'block';
        document.getElementById('status').innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ...";
        Tesseract.recognize(e.target.result, 'ara+eng', {
            logger: m => { if(m.status==="recognizing text"){document.getElementById('status').innerText = `â³ ${Math.round(m.progress*100)}%`;}}
        }).then(({data:{text}})=>{
            const clean = convertArabicNums(text).replace(/\D/g,'');
            const match = clean.match(/[23]\d{13}/);
            if(match){
                document.getElementById('nationalID').value = match[0];
                document.getElementById('status').innerText = "âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬";
                analyzeID();
            } else {
                document.getElementById('status').innerText = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ù‚ÙˆÙ…ÙŠ";
            }
        });
    };
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
